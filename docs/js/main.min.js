"use strict";var drawInterval,boardCanvas=document.getElementById("board"),snakeCanvas=document.getElementById("snake"),startButton=document.querySelector(".button--start"),pauseButton=document.querySelector(".button--pause"),board=boardCanvas.getContext("2d"),snake=snakeCanvas.getContext("2d"),CELL_SIZE=30,BOARD_SIZE={WIDTH:600,HEIGHT:600,START:0},COLOR={WHITE:"#FFFFFF",BLACK:"#000000",RED:"#AA0000",GREEN:"lightgreen",TRANSPARENT_WHITE:"rgba(255, 255, 255, 0.5)"},BUTTON_CODE={SPACE:32,LEFT_ARROW:37,UP_ARROW:38,RIGHT_ARROW:39,DOWN_ARROW:40},DIRECTION={LEFT:"left",TOP:"top",RIGHT:"right",BOTTOM:"bottom"},currentDirection=null,DEFAULT_DIRECTION=DIRECTION.RIGHT,score=0,GAME_STATUS={PLAY:0,NONE:1,GAMEOVER:2,GAMEWIN:3,PAUSE:4},currentGameStatus=GAME_STATUS.NONE,snakeBody=[{x:300,y:300},{x:270,y:300},{x:240,y:300}];boardCanvas.width=BOARD_SIZE.WIDTH,boardCanvas.height=BOARD_SIZE.HEIGHT;var getRandomAppleCoordinate=function(e,t){return Math.round((Math.random()*(t-e)+e)/CELL_SIZE)*CELL_SIZE},apple={x:getRandomAppleCoordinate(BOARD_SIZE.START,BOARD_SIZE.WIDTH-CELL_SIZE),y:getRandomAppleCoordinate(BOARD_SIZE.START,BOARD_SIZE.HEIGHT-CELL_SIZE)},updateScore=function(e){document.querySelector(".score span").textContent=e},drawMessages=function(){switch(currentGameStatus){case GAME_STATUS.NONE:board.clearRect(0,0,BOARD_SIZE.WIDTH,BOARD_SIZE.HEIGHT),board.fillStyle=COLOR.TRANSPARENT_WHITE,board.strokeStyle=COLOR.TRANSPARENT_WHITE,board.beginPath(),board.moveTo(0,0),board.lineTo(0,BOARD_SIZE.HEIGHT),board.moveTo(0,0),board.lineTo(BOARD_SIZE.WIDTH,0),board.moveTo(0,BOARD_SIZE.HEIGHT),board.lineTo(BOARD_SIZE.WIDTH,BOARD_SIZE.HEIGHT),board.moveTo(BOARD_SIZE.WIDTH,0),board.lineTo(BOARD_SIZE.WIDTH,BOARD_SIZE.HEIGHT),board.stroke(),board.font="32px sans-serif",board.fillText("Press space to start",150,300);break;case GAME_STATUS.PLAY:drawBoard()}},drawBoard=function(){board.clearRect(0,0,BOARD_SIZE.WIDTH,BOARD_SIZE.HEIGHT),board.strokeStyle=COLOR.TRANSPARENT_WHITE,board.beginPath();for(var e=BOARD_SIZE.START;e<=BOARD_SIZE.HEIGHT;e+=CELL_SIZE)board.moveTo(0,e),board.lineTo(BOARD_SIZE.WIDTH,e);for(var t=0;t<=BOARD_SIZE.HEIGHT;t+=CELL_SIZE)board.moveTo(t,BOARD_SIZE.START),board.lineTo(t,BOARD_SIZE.HEIGHT);board.stroke()},collisionCheck=function(a,r){r.forEach(function(e,t){e.x===a.x&&e.y===a.y&&(r.splice(t,r.length-t),score=snakeBody.length-2,updateScore(score))})},drawApple=function(){snake.fillStyle=COLOR.RED,snake.fillRect(apple.x,apple.y,CELL_SIZE,CELL_SIZE)},drawSnakePart=function(e){snake.fillStyle=COLOR.GREEN,snake.strokeStyle=COLOR.BLACK,snake.fillRect(e.x,e.y,CELL_SIZE,CELL_SIZE),snake.strokeRect(e.x,e.y,CELL_SIZE,CELL_SIZE)},drawSnake=function(){if(drawMessages(),null!==currentDirection){var e={x:snakeBody[0].x,y:snakeBody[0].y};snakeCanvas.width=BOARD_SIZE.WIDTH,snakeCanvas.height=BOARD_SIZE.HEIGHT,drawApple(),snakeBody.forEach(drawSnakePart),currentDirection===DIRECTION.LEFT&&(0===e.x?e.x=BOARD_SIZE.WIDTH-CELL_SIZE:e.x-=CELL_SIZE),currentDirection===DIRECTION.TOP&&(e.y===BOARD_SIZE.START?e.y=BOARD_SIZE.HEIGHT-CELL_SIZE:e.y-=CELL_SIZE),currentDirection===DIRECTION.RIGHT&&(e.x<BOARD_SIZE.WIDTH-CELL_SIZE?e.x+=CELL_SIZE:e.x=0),currentDirection===DIRECTION.BOTTOM&&(e.y===BOARD_SIZE.HEIGHT-CELL_SIZE?e.y=BOARD_SIZE.START:e.y+=CELL_SIZE),snakeBody[0].x===apple.x&&snakeBody[0].y===apple.y?(updateScore(++score),apple.x=getRandomAppleCoordinate(0,BOARD_SIZE.WIDTH-CELL_SIZE),apple.y=getRandomAppleCoordinate(0,BOARD_SIZE.HEIGHT-CELL_SIZE)):snakeBody.pop(),collisionCheck(e,snakeBody),snakeBody.unshift(e)}},createInterval=function(){return setInterval(drawSnake,1e3/6)},handleInput=function(e){e.preventDefault();var t=currentDirection!==DIRECTION.RIGHT&&currentDirection!==DIRECTION.LEFT,a=currentDirection!==DIRECTION.TOP&&currentDirection!==DIRECTION.BOTTOM;switch(e.keyCode){case BUTTON_CODE.SPACE:currentGameStatus=GAME_STATUS.PLAY,currentDirection=DEFAULT_DIRECTION;break;case BUTTON_CODE.LEFT_ARROW:t&&(currentDirection=DIRECTION.LEFT);break;case BUTTON_CODE.RIGHT_ARROW:t&&(currentDirection=DIRECTION.RIGHT);break;case BUTTON_CODE.UP_ARROW:a&&(currentDirection=DIRECTION.TOP);break;case BUTTON_CODE.DOWN_ARROW:a&&(currentDirection=DIRECTION.BOTTOM)}},changeGameStatus=function(e){switch(e){case GAME_STATUS.PLAY:currentGameStatus=GAME_STATUS.PLAY,null===currentDirection&&(currentDirection=DEFAULT_DIRECTION),clearInterval(drawInterval),drawInterval=createInterval();break;case GAME_STATUS.PAUSE:currentGameStatus=GAME_STATUS.PAUSE,clearInterval(drawInterval)}};window.onload=function(){document.addEventListener("keydown",handleInput),startButton.addEventListener("click",function(){return changeGameStatus(GAME_STATUS.PLAY)}),pauseButton.addEventListener("click",function(){return changeGameStatus(GAME_STATUS.PAUSE)}),drawInterval=createInterval()};